<div class="page-header d-flex justify-between align-center">
  <div>
    <h1 class="page-title"><%= category.name %></h1>
    <p><%= category.description || 'No description' %></p>
  </div>
  <div class="d-flex gap-2">
    <a href="/categories/<%= category.id %>/update" class="btn btn-warning"
      >Edit Category</a
    >
    <form
      method="POST"
      action="/categories/<%= category.id %>/delete"
      style="display: inline"
      onsubmit="return confirm('Are you sure you want to delete this category?')"
    >
      <button type="submit" class="btn btn-danger">Delete Category</button>
    </form>
  </div>
</div>

<div class="card">
  <div class="card-header">
    <h2 class="card-title">Category Details</h2>
  </div>
  <div class="grid grid-2">
    <div>
      <p><strong>Name:</strong> <%= category.name %></p>
      <p>
        <strong>Description:</strong> <%= category.description || 'No
        description' %>
      </p>
      <p>
        <strong>Created:</strong> <%= new
        Date(category.created_at).toLocaleString() %>
      </p>
      <p>
        <strong>Last Updated:</strong> <%= new
        Date(category.updated_at).toLocaleString() %>
      </p>
    </div>
    <div>
      <p><strong>Total Items:</strong> <%= items.length %></p>
      <a
        href="/items/create?category_id=<%= category.id %>"
        class="btn btn-success"
        >Add Item to Category</a
      >
    </div>
  </div>
</div>

<div class="card">
  <div class="card-header d-flex justify-between align-center">
    <h2 class="card-title">Items in <%= category.name %></h2>
    <a
      href="/items/create?category_id=<%= category.id %>"
      class="btn btn-success"
      >Add Item</a
    >
  </div>

  <% if (items.length === 0) { %>
  <div class="text-center">
    <p>No items in this category yet.</p>
    <a
      href="/items/create?category_id=<%= category.id %>"
      class="btn btn-primary"
      >Add First Item</a
    >
  </div>
  <% } else { %>
  <table class="table">
    <thead>
      <tr>
        <th>Image</th>
        <th>Name</th>
        <th>Description</th>
        <th>Price</th>
        <th>Stock</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% items.forEach(item => { %>
      <tr>
        <td>
          <% if (item.image_url) { %>
          <img
            src="<%= item.image_url %>"
            alt="<%= item.name %>"
            class="item-image"
          />
          <% } else { %>
          <div
            class="item-image"
            style="
              background-color: #e9ecef;
              display: flex;
              align-items: center;
              justify-content: center;
              color: #6c757d;
            "
          >
            No Image
          </div>
          <% } %>
        </td>
        <td><strong><%= item.name %></strong></td>
        <td><%= item.description || 'No description' %></td>
        <td class="price">$<%= parseFloat(item.price).toFixed(2) %></td>
        <td>
          <% if (item.stock_quantity === 0) { %>
          <span class="stock-low">Out of Stock</span>
          <% } else if (item.stock_quantity <= 5) { %>
          <span class="stock-medium"><%= item.stock_quantity %></span>
          <% } else { %>
          <span class="stock-ok"><%= item.stock_quantity %></span>
          <% } %>
        </td>
        <td class="actions">
          <a href="/items/<%= item.id %>" class="btn btn-primary btn-sm"
            >View</a
          >
          <a href="/items/<%= item.id %>/update" class="btn btn-warning btn-sm"
            >Edit</a
          >
          <form
            method="POST"
            action="/items/<%= item.id %>/delete"
            style="display: inline"
            onsubmit="return confirm('Are you sure you want to delete this item?')"
          >
            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
          </form>
        </td>
      </tr>
      <% }); %>
    </tbody>
  </table>
  <% } %>
</div>

<div class="mt-3">
  <a href="/categories" class="btn btn-secondary">Back to Categories</a>
</div>
